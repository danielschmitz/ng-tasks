import{a as f}from"./chunk-VYZYZZJW.js";import{a as d}from"./chunk-EZTHPUAS.js";import{$ as i,a as m,fa as p,k as g,t as h}from"./chunk-T4MBMAI6.js";var a=class r{constructor(){}set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){let t=localStorage.getItem(e);return t?JSON.parse(t):null}remove(e){localStorage.removeItem(e)}clear(){localStorage.clear()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var l="authUser",u="authToken",v=class r{storage=p(a);http=p(d);user=null;api=f.baseUrl;loginState=new g(this.isLogged());loginState$=this.loginState.asObservable();userState=new g(this.getUser());userState$=this.userState.asObservable();constructor(){}login(e,t,o){return this.http.post(`${this.api}/auth/login`,m({email:e,password:t},o&&{name:o})).pipe(h(n=>{let s=this.decodeJwt(n),c={id:s.id,name:s.name,email:s.email};return this.storage.set(l,c),this.storage.set(u,n),this.loginState.next(!0),this.userState.next(c),c}))}register(e,t,o){throw new Error("Method not implemented.")}isLogged(){return!!this.storage.get(l)}getUser(){return this.storage.get(l)}getToken(){return this.storage.get(u)}logout(){this.user=null,this.storage.remove(l),this.storage.remove(u),this.loginState.next(!1)}decodeJwt(e){let o=e.token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(o).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};export{v as a};
